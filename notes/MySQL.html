<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL 学习笔记 | 张恒华</title>
    <meta name="description" content="Here are Henghua Zhang's study notes and resume.">
    <meta name="generator" content="VitePress v1.0.0-rc.39">
    <link rel="preload stylesheet" href="/assets/style.3WgSaofv.css" as="style">
    
    <script type="module" src="/assets/app.oJqDAzRt.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.7l-q_CRe.js">
    <link rel="modulepreload" href="/assets/chunks/theme.Ycz3IDwK.js">
    <link rel="modulepreload" href="/assets/notes_MySQL.md.1CKH5tEl.lean.js">
    <link rel="icon" href="https://vuejs.org/logo.svg">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5a346dfe><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5a346dfe data-v-ae24b3ad><div class="VPNavBar has-sidebar" data-v-ae24b3ad data-v-19c990f1><div class="wrapper" data-v-19c990f1><div class="container" data-v-19c990f1><div class="title" data-v-19c990f1><div class="VPNavBarTitle has-sidebar" data-v-19c990f1 data-v-8460f0a8><a class="title" href="/" data-v-8460f0a8><!--[--><!--]--><!----><!--[-->张恒华<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-19c990f1><div class="content-body" data-v-19c990f1><!--[--><!--]--><div class="VPNavBarSearch search" data-v-19c990f1><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-19c990f1 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>学习笔记</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link active" href="/notes/MySQL.html" data-v-43f1e123><!--[-->MySQL<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/notes/Python.html" data-v-43f1e123><!--[-->Python<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/notes/C++.html" data-v-43f1e123><!--[-->C++<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/notes/protocol.html" data-v-43f1e123><!--[-->网络协议<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/notes/Django.html" data-v-43f1e123><!--[-->Django<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/notes/TypeScript.html" data-v-43f1e123><!--[-->TypeScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/notes/ArkTS.html" data-v-43f1e123><!--[-->ArkTS<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/resume.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>关于我</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-19c990f1 data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-1736f215 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1736f215><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1736f215><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-19c990f1 data-v-d0bd9dde data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>夜间模式</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-1736f215 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1736f215><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1736f215><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-19c990f1 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-19c990f1><div class="divider-line" data-v-19c990f1></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5a346dfe data-v-0282ae07><div class="container" data-v-0282ae07><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-0282ae07><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-0282ae07><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-0282ae07>菜单</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-0282ae07 data-v-af18c0d5><button data-v-af18c0d5>返回顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-5a346dfe data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 is-link has-active" data-v-575e6a36 data-v-e31bd47b><div class="item" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/notes/" data-v-e31bd47b><!--[--><h2 class="text" data-v-e31bd47b>学习笔记</h2><!--]--></a><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/notes/MySQL.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>MySQL</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/notes/Python.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Python</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/notes/C++.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>C++</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/notes/protocol.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>网络协议</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/notes/Django.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Django</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/notes/TypeScript.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>TypeScript</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/notes/ArkTS.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>ArkTS</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5a346dfe data-v-669faec9><div class="VPDoc has-sidebar has-aside" data-v-669faec9 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-935f8a84><div class="content" data-v-935f8a84><div class="outline-marker" data-v-935f8a84></div><div class="outline-title" role="heading" aria-level="2" data-v-935f8a84>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-935f8a84><span class="visually-hidden" id="doc-outline-aria-label" data-v-935f8a84> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-935f8a84 data-v-b933a997><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _notes_MySQL" data-v-39a288b8><div><h1 id="mysql-学习笔记" tabindex="-1">MySQL 学习笔记 <a class="header-anchor" href="#mysql-学习笔记" aria-label="Permalink to &quot;MySQL 学习笔记&quot;">​</a></h1><h2 id="sql" tabindex="-1">SQL <a class="header-anchor" href="#sql" aria-label="Permalink to &quot;SQL&quot;">​</a></h2><table><thead><tr><th>分类</th><th style="text-align:left;">全称</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td>DDL</td><td style="text-align:left;">Data Definition Language</td><td style="text-align:left;">数据定义语言，用来定义数据库对象（数据库、表、字段）</td></tr><tr><td>DML</td><td style="text-align:left;">Data Manipulation Language</td><td style="text-align:left;">数据操作语言，用来对数据库表中的数据进行增删改</td></tr><tr><td>DQL</td><td style="text-align:left;">Data Query Language</td><td style="text-align:left;">数据查询语句，用来查询数据空中表的记录</td></tr><tr><td>DCL</td><td style="text-align:left;">Data Control Language</td><td style="text-align:left;">数据控制语句，用来创建数据库用户、控制数据库访问权限</td></tr></tbody></table><h2 id="ddl-数据库操作" tabindex="-1">DDL-数据库操作 <a class="header-anchor" href="#ddl-数据库操作" aria-label="Permalink to &quot;DDL-数据库操作&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 查询</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW DATABASES;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [IF NOT EXISITS] </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`database_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [DEFAULT CHARSET `charset`] [COLLATE `collate`];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 删除</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [IF EXISTS] </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`database_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 使用</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `database_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h2 id="ddl-表操作-查询" tabindex="-1">DDL-表操作-查询 <a class="header-anchor" href="#ddl-表操作-查询" aria-label="Permalink to &quot;DDL-表操作-查询&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW TABLES;                     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 查询当前数据库所有表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 查询建表语句</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DESC</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 查询表结构</span></span></code></pre></div><h2 id="ddl-表操作-创建" tabindex="-1">DDL-表操作-创建 <a class="header-anchor" href="#ddl-表操作-创建" aria-label="Permalink to &quot;DDL-表操作-创建&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">table_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">` (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `field_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DATA_TYPE [COMMENT `field_1_comment`],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `field_2`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DATA_TYPE [COMMENT `field_2_comment`],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `field_n`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DATA_TYPE [COMMENT `field_n_comment`]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) [COMMENT `table_comment`];</span></span></code></pre></div><h2 id="ddl-表操作-数据类型" tabindex="-1">DDL-表操作-数据类型 <a class="header-anchor" href="#ddl-表操作-数据类型" aria-label="Permalink to &quot;DDL-表操作-数据类型&quot;">​</a></h2><table><thead><tr><th>分类</th><th>类型</th><th>大小</th><th>描述</th></tr></thead><tbody><tr><td rowspan="7">数值类型</td><td>TINYINT</td><td>1 byte</td><td></td></tr><tr><td>SMALLINT</td><td>2 bytes</td><td></td></tr><tr><td>MEDIUMINT</td><td>3 bytes</td><td></td></tr><tr><td>INT / INTEGER</td><td>4 bytes</td><td></td></tr><tr><td>BIGINT</td><td>8 bytes</td><td></td></tr><tr><td>FLOAT</td><td>4 bytes</td><td></td></tr><tr><td>DOUBLE</td><td>8 bytes</td><td></td></tr><tr><td rowspan="10">字符串类型</td><td>CHAR</td><td>0 ~ 255 bytes</td><td>定长字符串</td></tr><tr><td>VARCHAR</td><td>0 ~ 65535 bytes</td><td>变长字符串</td></tr><tr><td>TINYBLOB</td><td>0 ~ 255 bytes</td><td></td></tr><tr><td>TINYTEXT</td><td>0 ~ 255 bytes</td><td></td></tr><tr><td>BLOB</td><td>0 ~ 65535 bytes</td><td>二进制的长文本数据</td></tr><tr><td>TEXT</td><td>0 ~ 65535 bytes</td><td>长文本数据</td></tr><tr><td>MEDIUMBLOB</td><td>0 ~ 16777215 bytes</td><td></td></tr><tr><td>MEDIUMTEXT</td><td>0 ~ 16777215 bytes</td><td></td></tr><tr><td>LONGBLOB</td><td>0 ~ 4294967295 bytes</td><td>二进制形式的极大文本数据</td></tr><tr><td>LONGTEXT</td><td>0 ~ 4294967295 bytes</td><td>极大文本数据</td></tr></tbody></table><h2 id="ddl-表操作-修改" tabindex="-1">DDL-表操作-修改 <a class="header-anchor" href="#ddl-表操作-修改" aria-label="Permalink to &quot;DDL-表操作-修改&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 添加字段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ADD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `field`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [COMMENT `field_comment`];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 修改字段类型</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> MODIFY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `field`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 修改字段名和类型</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CHANGE </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`field`</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `new_field`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [COMMENT `field_comment`];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 删除字段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DROP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `field`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 修改表名</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RENAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `new_table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 删除表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [IF EXISTS] </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 删除并重建表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TRUNCATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>使用 <code>TRUNCATE TABLE table_name</code>，表中数据会被清空</p></div><h2 id="dml-插入数据" tabindex="-1">DML-插入数据 <a class="header-anchor" href="#dml-插入数据" aria-label="Permalink to &quot;DML-插入数据&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 给全部字段添加数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VALUE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`value_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`value_2`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ...);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 给指定字段添加数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`field_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`field_2`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ...) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`value_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`value_2`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ...);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 批量添加</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`field_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`field_2`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ...), (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`value_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`value_2`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ...), ...;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`field_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`field_2`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ...) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`value_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`value_2`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ...), (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`value_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`value_2`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ...), ...;</span></span></code></pre></div><h2 id="dml-修改数据" tabindex="-1">DML-修改数据 <a class="header-anchor" href="#dml-修改数据" aria-label="Permalink to &quot;DML-修改数据&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UPDATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> SET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `field_1`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`value_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`field_2`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`value_2`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ... [WHERE ...];</span></span></code></pre></div><h2 id="dml-删除数据" tabindex="-1">DML-删除数据 <a class="header-anchor" href="#dml-删除数据" aria-label="Permalink to &quot;DML-删除数据&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DELETE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [WHERE ...];</span></span></code></pre></div><h2 id="dql-基础查询" tabindex="-1">DQL-基础查询 <a class="header-anchor" href="#dql-基础查询" aria-label="Permalink to &quot;DQL-基础查询&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `field_1`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `alias_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`field_2`</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `alias_2`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- AS可省略</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT DISTINCT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 去重</span></span></code></pre></div><h2 id="dql-条件查询" tabindex="-1">DQL-条件查询 <a class="header-anchor" href="#dql-条件查询" aria-label="Permalink to &quot;DQL-条件查询&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `field`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ...;</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>使用 <code>WHERE BETWEEN a AND b</code> 时，<code>a</code> 应当小于 <code>b</code></p></div><h2 id="dql-聚合函数" tabindex="-1">DQL-聚合函数 <a class="header-anchor" href="#dql-聚合函数" aria-label="Permalink to &quot;DQL-聚合函数&quot;">​</a></h2><table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td>COUNT</td><td>统计数量</td></tr><tr><td>MAX</td><td>最大值</td></tr><tr><td>MIN</td><td>最小值</td></tr><tr><td>AVG</td><td>平均值</td></tr><tr><td>SUM</td><td>求和</td></tr></tbody></table><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>NULL</code> 不参与聚合运算</p></div><h2 id="dql-分组查询" tabindex="-1">DQL-分组查询 <a class="header-anchor" href="#dql-分组查询" aria-label="Permalink to &quot;DQL-分组查询&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [WHERE ...] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GROUP BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `field`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [HAVING ...];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 例：查询 tb_user 中各地区三十岁以下用户数量大于 3 的所有地区</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `address`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `user_num`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `tb_user`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `age`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GROUP BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `address`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">HAVING</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `user_num`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>WHERE</code> 与 <code>HAVING</code> 的区别：</p><ul><li>执行时机不同：<code>WHERE</code> 分组前进行过滤，不满足条件的数据不参与分组；<code>HAVING</code> 是分组后对结果进行过滤。</li><li>判断条件不同：<code>WHERE</code> 不能对聚合函数判断，而 <code>HAVING</code> 可以。</li></ul></div><h2 id="dql-排序查询" tabindex="-1">DQL-排序查询 <a class="header-anchor" href="#dql-排序查询" aria-label="Permalink to &quot;DQL-排序查询&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ORDER BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `field`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ASC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 升序，默认值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ORDER BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `field`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DESC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 降序</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ORDER BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `field_1`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ASC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`field_2`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DESC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 先对字段1进行升序排序，如果值相同则按字段2降序排序</span></span></code></pre></div><h2 id="dql-分页查询" tabindex="-1">DQL-分页查询 <a class="header-anchor" href="#dql-分页查询" aria-label="Permalink to &quot;DQL-分页查询&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> LIMIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page_num </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, page_size;</span></span></code></pre></div><h2 id="dql-执行顺序" tabindex="-1">DQL-执行顺序 <a class="header-anchor" href="#dql-执行顺序" aria-label="Permalink to &quot;DQL-执行顺序&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `addr`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 4</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `tb_user`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `user`</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              -- 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `age`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> BETWEEN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AND</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 40</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         -- 2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GROUP BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `addr`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> HAVING</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- 3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ORDER BY</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DESC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`addr`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ASC</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    -- 5</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LIMIT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                           -- 6</span></span></code></pre></div><h2 id="函数-字符串" tabindex="-1">函数-字符串 <a class="header-anchor" href="#函数-字符串" aria-label="Permalink to &quot;函数-字符串&quot;">​</a></h2><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><code>CONCAT(S1, S2, ..., Sn)</code></td><td>字符串拼接，将 <code>S1, S2, ..., Sn</code> 拼接成一个字符串</td></tr><tr><td><code>LOWER(str)</code></td><td>将字符串 <code>str</code> 转小写</td></tr><tr><td><code>UPPER(str)</code></td><td>将字符串 <code>str</code> 转大写</td></tr><tr><td><code>TRIM(str)</code></td><td>去掉字符串 <code>str</code> 首尾的空格</td></tr><tr><td><code>SUBSTRING(str, start, len)</code></td><td>返回字符串 <code>str</code> 从 <code>start</code> 开始的 <code>len</code> 长度的字符子串</td></tr><tr><td><code>LPAD(str, n, pad)</code></td><td>左填充，用字符串 <code>pad</code> 在 <code>str</code> 左边填充，直到 <code>str</code> 长度达到 <code>n</code></td></tr><tr><td><code>RPAD(str, n, pad)</code></td><td>右填充，用字符串 <code>pad</code> 在 <code>str</code> 右边填充，直到 <code>str</code> 长度达到 <code>n</code></td></tr></tbody></table><h2 id="函数-数值" tabindex="-1">函数-数值 <a class="header-anchor" href="#函数-数值" aria-label="Permalink to &quot;函数-数值&quot;">​</a></h2><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><code>CEIL(x)</code></td><td>向上取整</td></tr><tr><td><code>FLOOR(x)</code></td><td>向下取整</td></tr><tr><td><code>MOD(x, y)</code></td><td>返回 <code>x / y</code> 的模</td></tr><tr><td><code>RAND()</code></td><td>返回 0 ~ 1 内的随机数</td></tr><tr><td><code>ROUND(x, y)</code></td><td>返回 <code>x</code> 的四舍五入值，保留 <code>y</code> 位小数</td></tr></tbody></table><h2 id="函数-流程" tabindex="-1">函数-流程 <a class="header-anchor" href="#函数-流程" aria-label="Permalink to &quot;函数-流程&quot;">​</a></h2><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><code>IF(expr1, expr2, expr3)</code></td><td>如果 <code>expr1 = TRUE</code>，则返回 <code>expr2</code>，否则返回 <code>expr3</code></td></tr><tr><td><code>IFNULL(expr1, expr2)</code></td><td>如果 <code>expr1 IS NOT NULL</code>，则返回 <code>expr1</code>，否则返回 <code>expr2</code></td></tr><tr><td><code>CASE WHEN val THEN res ELSE default END</code></td><td>如果 <code>val = TRUE</code>，则返回 <code>res</code>，否则返回 <code>default</code></td></tr><tr><td><code>CASE t WHEN val THEN res ELSE default END</code></td><td>如果 <code>t = val</code>，则返回 <code>res</code>，否则返回 <code>default</code></td></tr></tbody></table><h2 id="约束" tabindex="-1">约束 <a class="header-anchor" href="#约束" aria-label="Permalink to &quot;约束&quot;">​</a></h2><table><thead><tr><th>约束</th><th>描述</th><th>关键字</th></tr></thead><tbody><tr><td>非空约束</td><td>字段值不能为 <code>NULL</code></td><td><code>NOT NULL</code></td></tr><tr><td>唯一约束</td><td>保证该字段的所有值都是不重复的</td><td><code>UNIQUE</code></td></tr><tr><td>主键约束</td><td>主键是一行数据的唯一标识，非空且唯一</td><td><code>PRIMART KEY</code></td></tr><tr><td>默认约束</td><td>插入数据时如未指定该字段值，则采用默认值</td><td><code>DEFAULT</code></td></tr><tr><td>检查约束</td><td>保证字段值满足条件 (MySQL8新特性)</td><td><code>CHECK</code></td></tr></tbody></table><h2 id="多表查询-内连接" tabindex="-1">多表查询-内连接 <a class="header-anchor" href="#多表查询-内连接" aria-label="Permalink to &quot;多表查询-内连接&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 隐式内连接</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ... </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`table_2`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ...;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 显式内连接</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ... </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_1`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [INNER] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">JOIN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_2`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ...;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 例：查询每一个员工的姓名和部门名称</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 表：tb_emp, tb_dept</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 连接条件：tb_emp.dept_id = tb_dept.id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `tb_emp`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`tb_dept`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `tb_emp`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`tb_dept`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHERE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `tb_emp`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`dept_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `tb_dept`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 隐式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `tb_emp`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`tb_dept`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `tb_emp`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INNER JOIN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `tb_dept`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `tb_emp`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`dept_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `tb_dept`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 显式</span></span></code></pre></div><h2 id="多表查询-外连接" tabindex="-1">多表查询-外连接 <a class="header-anchor" href="#多表查询-外连接" aria-label="Permalink to &quot;多表查询-外连接&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ... </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_1`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> LEFT  OUTER JOIN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_2`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ...;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 左外连接</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ... </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_1`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> RIGHT OUTER JOIN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_2`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ...;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 右外连接</span></span></code></pre></div><h2 id="多表查询-自连接" tabindex="-1">多表查询-自连接 <a class="header-anchor" href="#多表查询-自连接" aria-label="Permalink to &quot;多表查询-自连接&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ... </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `alias_1`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INNER JOIN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `alias_2`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ...;</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>自连接可以是内连接也可以是外连接。</p></div><h2 id="多表查询-联合查询" tabindex="-1">多表查询-联合查询 <a class="header-anchor" href="#多表查询-联合查询" aria-label="Permalink to &quot;多表查询-联合查询&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ... </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_1`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UNION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ALL]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ... </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_2`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>联合查询的列数与字段类型必须保持一致。</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>UNION ALL</code> 会把全部结果直接合并在一起，<code>UNION</code> 会对合并之后的数据去重。</p></div><h2 id="多表查询-子查询" tabindex="-1">多表查询-子查询 <a class="header-anchor" href="#多表查询-子查询" aria-label="Permalink to &quot;多表查询-子查询&quot;">​</a></h2><h3 id="标量子查询" tabindex="-1">标量子查询 <a class="header-anchor" href="#标量子查询" aria-label="Permalink to &quot;标量子查询&quot;">​</a></h3><p>子查询结果返回的是单个值（数字、字符串、日期等），最简单的形式，这种子查询称为 <strong>标量子查询</strong>。<br> 常用操作符：<code>=</code> <code>&lt;&gt;</code> <code>&gt;</code> <code>&lt;</code> <code>&gt;=</code> <code>&lt;=</code></p><h3 id="列子查询" tabindex="-1">列子查询 <a class="header-anchor" href="#列子查询" aria-label="Permalink to &quot;列子查询&quot;">​</a></h3><p>子查询结果返回的是一列，这种子查询称为 <strong>列子查询</strong>。<br> 常用操作符：<code>IN</code> <code>NOT IN</code> <code>ANY</code> <code>SOME</code> <code>ALL</code></p><table><thead><tr><th>操作符</th><th>描述</th></tr></thead><tbody><tr><td><code>IN</code></td><td>在指定集合范围之内，多选一</td></tr><tr><td><code>NOT IN</code></td><td>不在指定集合范围之内</td></tr><tr><td><code>ANY</code></td><td>子查询返回列表中，在一个任意满足即可</td></tr><tr><td><code>SOME</code></td><td>与 <code>ANY</code> 等同，使用 <code>SOME</code> 的地方都可以用 <code>ANY</code></td></tr><tr><td><code>ALL</code></td><td>子查询返回列表的所有值都必须满足</td></tr></tbody></table><h3 id="行子查询" tabindex="-1">行子查询 <a class="header-anchor" href="#行子查询" aria-label="Permalink to &quot;行子查询&quot;">​</a></h3><p>子查询结果返回的是一行，这种子查询称为 <strong>列子查询</strong>。<br> 常用操作符：<code>IN</code> <code>NOT IN</code> <code>=</code> <code>&lt;&gt;</code></p><h3 id="表子查询" tabindex="-1">表子查询 <a class="header-anchor" href="#表子查询" aria-label="Permalink to &quot;表子查询&quot;">​</a></h3><p>子查询结果返回的是多行多列，这种子查询称为 <strong>表子查询</strong>。<br> 常用操作符：<code>IN</code></p><h2 id="事务-操作" tabindex="-1">事务-操作 <a class="header-anchor" href="#事务-操作" aria-label="Permalink to &quot;事务-操作&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 自动提交</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @@AUTOCOMMIT;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 查看提交方式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @@AUTOCOMMIT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 关闭自动提交</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @@AUTOCOMMIT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 开启自动提交</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 事务操作</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BEGIN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 开启事务</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">START TRANSACTION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 开启事务</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COMMIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 提交事务</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ROLLBACK</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 回滚事务</span></span></code></pre></div><h2 id="事务-四大特性" tabindex="-1">事务-四大特性 <a class="header-anchor" href="#事务-四大特性" aria-label="Permalink to &quot;事务-四大特性&quot;">​</a></h2><ul><li>原子性（Atomicity）：事务是不可分割的最小单元，要么全部成功，要么全部失败。</li><li>一致性（Consistency）：事务完成时，必须所有数据都保持一致状态。</li><li>隔离性（Isolation）：数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。</li><li>持久性（Durability）：事务一旦提交或回滚，它对数据库中的数据的改变就是永久的。</li></ul><h2 id="事务-并发问题" tabindex="-1">事务-并发问题 <a class="header-anchor" href="#事务-并发问题" aria-label="Permalink to &quot;事务-并发问题&quot;">​</a></h2><table><thead><tr><th>问题</th><th>描述</th></tr></thead><tbody><tr><td>脏读</td><td>一个事务读到另一个事务还没有提交的数据</td></tr><tr><td>不可重复读</td><td>一个事务先后读取同一条记录，但两次读取的数据不同</td></tr><tr><td>幻读</td><td>一个事务按照条件查询数据时，没有对应的数据行，但是在插入时，又发现这行数据存在</td></tr></tbody></table><h2 id="事务-隔离级别" tabindex="-1">事务-隔离级别 <a class="header-anchor" href="#事务-隔离级别" aria-label="Permalink to &quot;事务-隔离级别&quot;">​</a></h2><table><thead><tr><th>隔离级别</th><th style="text-align:center;">脏读</th><th style="text-align:center;">不可重复读</th><th style="text-align:center;">幻读</th></tr></thead><tbody><tr><td>read uncommitted</td><td style="text-align:center;">√</td><td style="text-align:center;">√</td><td style="text-align:center;">√</td></tr><tr><td>read committed</td><td style="text-align:center;">×</td><td style="text-align:center;">√</td><td style="text-align:center;">√</td></tr><tr><td>repeatable read（默认）</td><td style="text-align:center;">×</td><td style="text-align:center;">×</td><td style="text-align:center;">√</td></tr><tr><td>serializable</td><td style="text-align:center;">×</td><td style="text-align:center;">×</td><td style="text-align:center;">×</td></tr></tbody></table><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 查看事务隔离级别</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @@TRANSACTION_ISOLATION;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 设置事务隔离级别</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [SESSION | GLOBAL] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TRANSACTION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ISOLATION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> LEVEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE]</span></span></code></pre></div><h2 id="存储引擎" tabindex="-1">存储引擎 <a class="header-anchor" href="#存储引擎" aria-label="Permalink to &quot;存储引擎&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW ENGINES;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 查看所有引擎</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">`(...) ENGINE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">INNODB;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 设置存储引擎</span></span></code></pre></div><table><thead><tr><th>InnoDB</th><th>MyISAM</th></tr></thead><tbody><tr><td>支持事务</td><td>不支持事务</td></tr><tr><td>支持外键</td><td>不支持外键</td></tr><tr><td>支持行级锁</td><td>支持表级锁</td></tr></tbody></table><ul><li>InnoDB：MySQL 默认的存储引擎。如果对事务、数据一致性有高要求，InnoDB 比较合适。</li><li>MyISAM：如果以查询和插入为主，很少更新和删除，可以选用 MyISAM。例如：日志的存储。</li><li>Memory：将数据保存再内存中，访问速度快。</li></ul><p>实际上，绝大部分场景都是 InnoDB，另外两种都被别的 NoSQL 数据库替代了。例如：用 MangoDB 替代 MyISAM，Redis 替代 Memory。</p><p>InnoDB逻辑存储结构：<br><img src="/assets/Innodb.8Olcqls6.png" alt="Innodb Structure"></p><h2 id="索引-分类" tabindex="-1">索引-分类 <a class="header-anchor" href="#索引-分类" aria-label="Permalink to &quot;索引-分类&quot;">​</a></h2><table><thead><tr><th>分类</th><th>含义</th><th>特点</th><th>关键字</th></tr></thead><tbody><tr><td>主键索引</td><td>针对表中主键创建的索引</td><td>默认创建，只能有一个</td><td><code>PRIMARY</code></td></tr><tr><td>唯一索引</td><td>同一个表中某字段的值不重复</td><td>可以有多个</td><td><code>UNIQUE</code></td></tr><tr><td>常规索引</td><td>快速查找特定数据</td><td>可以有多个</td><td></td></tr><tr><td>全文索引</td><td>查找的是文本中的关键字，而不是索引的值</td><td>可以有多个</td><td><code>FULLTEXT</code></td></tr></tbody></table><p>在 InnoDB 存储引擎中，根据索引的存储形式，又可以分为以下几种：</p><table><thead><tr><th>分类</th><th>含义</th><th>特点</th></tr></thead><tbody><tr><td>聚集索引</td><td>将数据存储和索引放到一块，索引结构的叶子节点保存了行数据</td><td>必须有，且只有一个</td></tr><tr><td>二级索引</td><td>将数据和索引分开存储，索引结构的叶子节点关联的是对应的主键</td><td>可以存在多个</td></tr></tbody></table><p>聚集索引选取规则：</p><ul><li>如果存在主键，主键索引就是聚集索引</li><li>如果不存在主键，将使用第一个唯一(UNIQUE)索引作为聚集索引。</li><li>如果没有主键和合适的唯一索引，则 InnoDB 会自动生成的一个 <code>rowid</code> 作为隐藏的聚集索引。</li></ul><h2 id="索引-语法" tabindex="-1">索引-语法 <a class="header-anchor" href="#索引-语法" aria-label="Permalink to &quot;索引-语法&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [UNIQUE|FULLTEXT] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INDEX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `index_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`field`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ...);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 查看索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INDEX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 删除索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INDEX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `index_name`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h2 id="索引-性能分析" tabindex="-1">索引-性能分析 <a class="header-anchor" href="#索引-性能分析" aria-label="Permalink to &quot;索引-性能分析&quot;">​</a></h2><ul><li><strong>SQL执行频率</strong></li></ul><p>通过 <code>SHOW [SESSION|GLOBAL] STATUS</code> 指令可以提供服务器状态信息。可在此基础上通过 <code>LIKE</code> 匹配出增删改查的频次信息，如：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SESSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> STATUS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> LIKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Com_______&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 输出：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- +---------------+-------+</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Variable_name | Value |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- +---------------+-------+</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Com_binlog    | 0     |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Com_commit    | 0     |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Com_delete    | 0     |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Com_import    | 0     |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Com_insert    | 0     |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Com_repair    | 0     |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Com_revoke    | 0     |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Com_select    | 0     |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Com_signal    | 0     |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Com_update    | 0     |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Com_xa_end    | 0     |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- +---------------+-------+</span></span></code></pre></div><p>其中，增删改查的频次分别对应表中的 <code>Com_insert</code>、<code>Com_delete</code>、<code>Com_update</code>、<code>Com_select</code> 的值。</p><ul><li><strong>慢查询日志</strong></li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @@slow_query_log;       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 慢查询日志开关，0-关闭，1-开启</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @@slow_query_log_file;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 慢查询日志所在文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @@long_query_time;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 单位：秒。SQL执行时间超过该值就会被记入慢查询日志</span></span></code></pre></div><p>以上变量可以前往 MySQL 的配置文件 <code>my.ini</code>(Windows) / <code>my.cnf</code>(Linux) 进行修改：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>slow-query-log=1</span></span>
<span class="line"><span>slow_query_log_file=&quot;slow.log&quot;</span></span>
<span class="line"><span>long_query_time=10</span></span></code></pre></div><ul><li><strong>profile</strong></li></ul><p><code>SHOW PROFILES</code> 能够帮助我们在做 SQL 优化时了解每句 SQL 的执行时间。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW VARIABLES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LIKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%profiling%&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- +------------------------+-------+</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | Variable_name          | Value |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- +------------------------+-------+</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | have_profiling         | YES   |  -- 当前 MySQL 是否支持 profile 操作</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | profiling              | OFF   |  -- 默认关闭，可以通过 SET 语句开启</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- | profiling_history_size | 15    |  -- SQL 最近执行的记录数量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- +------------------------+-------+</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> profiling</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 开启 profiles 操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW PROFILES;</span></span></code></pre></div><ul><li><strong>EXPLAIN 执行计划</strong></li></ul><p><code>EXPLAIN</code> 或者 <code>DESC</code> 命令可查看 MySQL 如何执行 SQL 的信息。返回的信息如下：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+----+-------------+---------+------+---------------+------+---------+------+----------+-------+</span></span>
<span class="line"><span>| id | select_type | table   | type | possible_keys | key  | key_len | rows | filtered | Extra |</span></span>
<span class="line"><span>+----+-------------+---------+------+---------------+------+---------+------+----------+-------+</span></span>
<span class="line"><span>|  1 | SIMPLE      | tb_user | ALL  | NULL          | NULL | NULL    |    1 |   100.00 | NULL  |</span></span>
<span class="line"><span>+----+-------------+---------+------+---------------+------+---------+------+----------+-------+</span></span></code></pre></div><p><code>EXPLAIN</code> 执行计划各字段含义：</p><ul><li><code>id</code>：<code>SELECT 查询</code> 的序列号，表示查询中执行 <code>SELECT 子句</code> 或表连接的顺序（<code>id</code> 相同，执行顺序从上到下；<code>id</code> 不同，值越大，越先执行）。</li><li><code>select_type</code>：表示 <code>SELECT</code> 的类型，常见的取值有：<code>SIMPLE</code>（简单表，即不使用子查询和表连接）、<code>SUBQUERY</code>（<code>SELECT</code> / <code>WHERE</code> 之后包含了子查询）等。</li><li><code>type</code>：连接类型。性能由好到差分别为：<code>NULL</code>(不连接表), <code>SYSTEM</code>(访问系统表), <code>const</code>(根据主键或唯一索引访问), <code>ref</code>(使用非唯一索引), <code>RANGE</code>(使用非唯一索引，但是进行了范围匹配), <code>INDEX</code>(遍历整个索引树), <code>ALL</code>(全表扫描)。</li><li><code>possible_keys</code>：可能用到的索引，一个或多个。</li><li><code>key</code>：实际用到的索引。</li><li><code>key_len</code>：索引中使用的字节数，该值为最大可能长度，并非实际使用长度。该值越短越好。</li><li><code>rows</code>：MySQL 认为必须要查询的行数，在 InnoDB 中为估计值，并不总是准确的。</li><li><code>filtered</code>：返回结果的行数占读取行数的百分比，越大越好。</li></ul><h2 id="索引-使用规则" tabindex="-1">索引-使用规则 <a class="header-anchor" href="#索引-使用规则" aria-label="Permalink to &quot;索引-使用规则&quot;">​</a></h2><ul><li><strong>最左前缀法则</strong></li></ul><p>使用联合索引要遵守最左前缀法则，即从索引的最左列开始，依次生效。如果某一列不匹配，<!---->（后面的索引列无效）。</p><ul><li><strong>范围查询</strong></li></ul><p>联合索引中，出现 <code>&lt;</code> 或 <code>&gt;</code> 等范围查询，会导致后面的<!---->。</p><ul><li><strong>索引列运算</strong></li></ul><p>在索引列上运算将导致<!---->。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 要求：查询手机号以166开头的用户</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 表：tb_user, 索引：idx_user_phone(建立在phone字段上的索引)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 索引列发生计算，索引失效</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SUBSTRING</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`phone`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;166&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 使用模糊查询代替了索引列的计算，索引生效</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `phone`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> LIKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;166%&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><ul><li><strong>字符串不加引号</strong></li></ul><p>字符串类型的字段数值不加引号，<!---->。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 表: tb_user, 字段: phone(字符串类型, 有索引)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> phone </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  166888</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 索引失效</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> phone </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;166888&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 索引有效</span></span></code></pre></div><ul><li><strong>模糊查询</strong></li></ul><p>尾部模糊匹配，索引有效。头部模糊匹配，<!---->。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 表: tb_user, 字段: phone(字符串类型, 有索引)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> phone </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LIKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%888&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 索引失效</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> phone </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LIKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;166%&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 索引有效</span></span></code></pre></div><ul><li><strong><code>OR</code>连接的条件查询</strong></li></ul><p>使用 <code>OR</code> 连接的条件，任意一侧无索引都将导致，<code>OR</code> 另一端的<!---->。</p><ul><li><strong>数据分布影响</strong></li></ul><p>如果 MySQL 评估使用索引比全表扫描更慢，则不会使用索引。</p><ul><li><strong>覆盖索引</strong></li></ul><p>如果联合索引的索引列覆盖了需要查找的所有字段，则MySQL不用再回表查询。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INDEX</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> idx_age_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user (age, username);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 建立联合索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id, username, age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 不需要回表查询</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id, age, phone </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 需要回表查询</span></span></code></pre></div><p>上面SQL执行由于在二级索引上能够获取到 <code>id</code>, <code>username</code>, <code>age</code>，此时不再回表查询。而 <code>phone</code> 的数据不在二级索引上，此时MySQL会用对应的 <code>id</code> 回表查询拿到对应 <code>phone</code> 数据。</p><ul><li><strong>前缀索引</strong></li></ul><p>将字符串开头的一部分作为前缀建立索引。相较于将整个长字符串建立索引，前缀索引大大节省了索引空间，提高了索引效率。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 将字段的前n个字符制作成前缀索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INDEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">index_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">` </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `table_name`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`field`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(n));</span></span></code></pre></div><h2 id="sql优化-insert" tabindex="-1">SQL优化-<code>INSERT</code> <a class="header-anchor" href="#sql优化-insert" aria-label="Permalink to &quot;SQL优化-`INSERT`&quot;">​</a></h2><p>使用批量插入代替多次的单行插入：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 多次插入 ×</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Tom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Jerry&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 批量插入 √</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Tom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Jerry&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>手动提交事务，代替自动提交事务：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 自动提交 ×</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Tom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Jerry&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 手动提交 ×</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">START TRANSACTION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Tom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Jerry&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COMMIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h2 id="sql优化-主键" tabindex="-1">SQL优化-主键 <a class="header-anchor" href="#sql优化-主键" aria-label="Permalink to &quot;SQL优化-主键&quot;">​</a></h2><ul><li>满足业务需求的情况下，尽量降低主键的长度。因为每一个二级索引下的叶子节点都挂着主键。</li><li>插入数据时，尽量顺序插入，选择使用 <code>AUTO_INCREMENT</code> 自增主键。因为主键无序插入可能会导致页分裂。</li></ul><h2 id="sql优化-order-by" tabindex="-1">SQL优化-<code>ORDER BY</code> <a class="header-anchor" href="#sql优化-order-by" aria-label="Permalink to &quot;SQL优化-`ORDER BY`&quot;">​</a></h2><ul><li><code>Using filesort</code>: 读取满足条件的数据行，然后在排序缓冲区中完成排序操作。所有不是通过索引返回的排序都叫 <code>FileSort</code> 排序。</li><li><code>Using index</code>: 通过扫描索引直接返回有序数据，不需要额外排序，效率高。</li></ul><h2 id="sql优化-count" tabindex="-1">SQL优化-<code>COUNT</code> <a class="header-anchor" href="#sql优化-count" aria-label="Permalink to &quot;SQL优化-`COUNT`&quot;">​</a></h2><div class="language-SQL vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tb_user;</span></span></code></pre></div><p>MyISAM 引擎把一个表的总行数存在了磁盘上，因此执行 <code>COUNT(*)</code> 查询全表总行数的时候可以直接返回这个数。<br> InnoDB 则会把数据一行一行读出来，累积计数。</p><p><code>COUNT</code> 几种用法的区别：</p><ul><li><p><code>COUNT(primary_key)</code>: InnoDB 引擎会遍历整个表，把每一行的主键值取出来，返回给服务层。服务层拿到主键后，直接按行进行计数。</p></li><li><p><code>COUNT(field)</code>:</p></li></ul><ol><li>如果没有 <code>NOT NULL</code> 约束，InnoDB 引擎会遍历整张表把每一行的字段值都取出来，返回给服务层，服务层判断值是否为 <code>NULL</code>，不为 <code>NULL</code> 则计数 + 1；</li><li>如果有 <code>NOT NULL</code> 约束，InnoDB 引擎会遍历整张表把每一行的字段值都取出来，返回给服务层，直接按行进行计数。</li></ol><ul><li><p><code>COUNT(1)</code>: InnoDB 引擎遍历整张表，但不取数据。服务层对应每一行，放一个数字 1 进去，直接按行进行计数。<code>COUNT(0)</code>、<code>COUNT(-1)</code> 也是一样的效果，只要不是 <code>COUNT(NULL)</code> 就行。</p></li><li><p><code>COUNT(*)</code>: InnoDB 引擎不会把全部字段取出来，而是专门做了优化，不取值，服务层直接按行计数。</p></li></ul><p>效率：<code>COUNT(field)</code> &lt; <code>COUNT(primary_key)</code> &lt; <code>COUNT(1)</code> ≈ <code>COUNT(*)</code></p><h2 id="sql优化-update" tabindex="-1">SQL优化-<code>UPDATE</code> <a class="header-anchor" href="#sql优化-update" aria-label="Permalink to &quot;SQL优化-`UPDATE`&quot;">​</a></h2><p>InnoDB的行锁是针对索引加的锁，不是针对记录加的锁。<code>UPDATE</code> 时尽量把索引字段作为 <code>WHERE</code> 条件，并且该索引不能失效，否则会从行锁升级为表锁。</p><h2 id="锁" tabindex="-1">锁 <a class="header-anchor" href="#锁" aria-label="Permalink to &quot;锁&quot;">​</a></h2><ol><li>全局锁：锁定数据库中所有表</li><li>表级锁：每次操作锁住整张表</li><li>行级锁：每次操作锁住对应行</li></ol><h3 id="全局锁" tabindex="-1">全局锁 <a class="header-anchor" href="#全局锁" aria-label="Permalink to &quot;全局锁&quot;">​</a></h3><p>全局锁对整个数据库实例加锁，加锁后整个实例就处于只读的状态，后续的写入操作都将被阻塞。</p><p>最典型的使用场景就是做全库的逻辑备份，对所有表进行锁定，从而获取一致性视图，保证数据的完整性。</p><div class="language-SQL vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FLUSH TABLES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WITH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> READ</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LOCK;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 锁定所有数据库</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TABLES;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 解锁</span></span></code></pre></div><div class="language-SHELL vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">SHELL</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqldump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -uroot</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p123456</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db_test</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.sql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 备份 db_test 的所有数据到 test.sql</span></span></code></pre></div><p>数据库中加全局锁，是一个比较重的操作，存在以下问题：</p><ol><li>如果在主库上备份，那么在备份期间都不能执行写入操作，业务基本停摆</li><li>如果在从库上备份，那么在备份期间从库都不能执行主库同步过来的二进制日志（binlog），会导致主从延迟</li></ol><p>在 InnoDB 引擎中，我们可以在备份时加上参数 <code>--single-transaction</code> 来完成不加锁的一致性数据备份。</p><div class="language-SHELL vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">SHELL</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqldump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --single-transaction</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -uroot</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p123456</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db_test</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.sql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="表级锁" tabindex="-1">表级锁 <a class="header-anchor" href="#表级锁" aria-label="Permalink to &quot;表级锁&quot;">​</a></h3><p>表级锁，每次操作锁住整张表。锁定粒度较大，发生锁冲突的概率高，并发度低。应用在 MyISAM、InnoDB 等存储引擎中。</p><p>表级锁可分为三类：表锁、元数据锁（meta data lock, MDL）、意向锁</p><h3 id="表级锁-表锁" tabindex="-1">表级锁-表锁 <a class="header-anchor" href="#表级锁-表锁" aria-label="Permalink to &quot;表级锁-表锁&quot;">​</a></h3><p>表锁可分为两类：</p><ol><li>表共享读锁（read lock）：当前客户端只能读不能写，其他客户端也只能读不能写</li><li>表独占写锁（write lock）：当前客户端能读能写，其他客户端不能读不能写</li></ol><div class="language-SQL vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LOCK TABLES </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`tb_test`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> READ/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">WRITE;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 加锁</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TABLES;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 释放锁，断开客户端连接也能释放</span></span></code></pre></div><h3 id="行级锁" tabindex="-1">行级锁 <a class="header-anchor" href="#行级锁" aria-label="Permalink to &quot;行级锁&quot;">​</a></h3><p>行级锁，每次操作锁住对应的行数据。锁定粒度小，发生锁冲突的概率低。</p><p>行级锁可分为三类：</p><ol><li>行锁（Record Lock）：锁定单个行记录的锁。行锁又分为：共享锁（S）、排他锁（X）。</li><li>间隙锁（Gap Lock）：锁定记录间隙（不含该记录），确保记录间隙不变，避免其他事务在这个间隙插入数据，防止产生幻读。</li><li>临键锁（Next-Key Lock）：行锁和间隙锁的组合，同时锁住行数据，并锁住前面的间隙。</li></ol></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-48f9bb55><!--[--><!--]--><!----><nav class="prev-next" data-v-48f9bb55><div class="pager" data-v-48f9bb55><!----></div><div class="pager" data-v-48f9bb55><a class="VPLink link pager-link next" href="/notes/Python.html" data-v-48f9bb55><!--[--><span class="desc" data-v-48f9bb55>Next page</span><span class="title" data-v-48f9bb55>Python</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5a346dfe data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>Released under the <a href="/LICENSE">MIT License</a>.</p><p class="copyright" data-v-e315a0ad>
                Copyright © 2022-present <a href="/resume">张恒华</a><br />
                <a href="https://beian.miit.gov.cn" target="_black">湘ICP备2024042555号</a><br />
                <img src="https://beian.mps.gov.cn/img/logo01.dd7ff50e.png" width="16" height="17" style="vertical-align:middle;display:inline" />
                <a href="https://beian.mps.gov.cn/#/query/webSearch?code=43112602000261" rel="noreferrer" target="_blank">湘公网安备43112602000261</a>
            </p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"harmony.md\":\"IlGTb40X\",\"resume.md\":\"I00M1QGc\",\"hnradio.md\":\"ZsSqaxG-\",\"notes_index.md\":\"K0c1ANeB\",\"license.md\":\"3mn3o3Lo\",\"notes_typescript.md\":\"ohB_NAoU\",\"notes_protocol.md\":\"T1igZNM2\",\"index.md\":\"frhT0loc\",\"notes_arkts.md\":\"wVfWm9bR\",\"notes_vue.md\":\"szdYTZzG\",\"notes_django.md\":\"FE7Q5DLJ\",\"notes_python.md\":\"uQcSaqed\",\"notes_mysql.md\":\"1CKH5tEl\",\"notes_c__.md\":\"lQIo-bsI\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"张恒华\",\"description\":\"Here are Henghua Zhang's study notes and resume.\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"darkModeSwitchLabel\":\"夜间模式\",\"sidebarMenuLabel\":\"菜单\",\"outlineTitle\":\"目录\",\"outline\":[2,3],\"returnToTopLabel\":\"返回顶部\",\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"学习笔记\",\"items\":[{\"text\":\"MySQL\",\"link\":\"/notes/MySQL\"},{\"text\":\"Python\",\"link\":\"/notes/Python\"},{\"text\":\"C++\",\"link\":\"/notes/C++\"},{\"text\":\"网络协议\",\"link\":\"/notes/protocol\"},{\"text\":\"Django\",\"link\":\"/notes/Django\"},{\"text\":\"TypeScript\",\"link\":\"/notes/TypeScript\"},{\"text\":\"ArkTS\",\"link\":\"/notes/ArkTS\"}]},{\"text\":\"关于我\",\"link\":\"/resume\"}],\"sidebar\":{\"/notes/\":[{\"text\":\"学习笔记\",\"link\":\"/notes/\",\"items\":[{\"text\":\"MySQL\",\"link\":\"/notes/MySQL\"},{\"text\":\"Python\",\"link\":\"/notes/Python\"},{\"text\":\"C++\",\"link\":\"/notes/C++\"},{\"text\":\"网络协议\",\"link\":\"/notes/protocol\"},{\"text\":\"Django\",\"link\":\"/notes/Django\"},{\"text\":\"TypeScript\",\"link\":\"/notes/TypeScript\"},{\"text\":\"ArkTS\",\"link\":\"/notes/ArkTS\"}]}]},\"footer\":{\"message\":\"Released under the <a href=\\\"/LICENSE\\\">MIT License</a>.\",\"copyright\":\"\\n                Copyright © 2022-present <a href=\\\"/resume\\\">张恒华</a><br />\\n                <a href=\\\"https://beian.miit.gov.cn\\\" target=\\\"_black\\\">湘ICP备2024042555号</a><br />\\n                <img src=\\\"https://beian.mps.gov.cn/img/logo01.dd7ff50e.png\\\" width=\\\"16\\\" height=\\\"17\\\" style=\\\"vertical-align:middle;display:inline\\\" />\\n                <a href=\\\"https://beian.mps.gov.cn/#/query/webSearch?code=43112602000261\\\" rel=\\\"noreferrer\\\" target=\\\"_blank\\\">湘公网安备43112602000261</a>\\n            \"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>